# python_pipeline/tools/backup_and_restore/metadata.yml

# --- Basic Information ---
# These fields populate the script selection list and provide context to the user.
displayName: "Device Backup & Restore"
description: "A tool to perform configuration backups from a device or restore a configuration to a device. The form will dynamically change based on the selected action."
category: "Device Management"

# --- CHANGE 1: ADD THIS CAPABILITY FLAG ---
# This flag tells PythonScriptRunner to render the specialized DeviceAuthFields component.
capabilities:
  deviceAuth: true

# --- Parameters: This list defines the form fields in the UI ---
parameters:
  # --- Common parameters, always visible ---
  # This is the key parameter that will control the dynamic form
  - name: "command"
    label: "Action to Perform"
    type: "radio" # Renders as a <select> dropdown
    required: true
    default: "backup"
    options:
      - { value: "backup", label: "Perform Backup" }
      - { value: "restore", label: "Perform Restore" }
    layout: "horizontal"
    description: "Choose whether to back up from or restore to the device."

  # --- Backup-specific parameters ---
  # These fields will ONLY be shown if the 'Action' dropdown is set to 'Perform Backup'.
  # The 'show_if' key is our instruction to the frontend.
  - name: "backup_path"
    label: "Backup Directory Path"
    type: "text"
    default: "./backups"
    description: "The directory inside the container where backups will be saved."
    show_if: { name: "command", value: "backup" }
    layout: "horizontal"

  - name: "config_only"
    label: "Configuration Files Only"
    type: "boolean" # Renders as a checkbox
    default: false
    description: "If checked, only backs up configuration files (text, set, xml, json)."
    show_if: { name: "command", value: "backup" }

  # --- Restore-specific parameters ---
  # These fields will ONLY be shown if the 'Action' is set to 'Perform Restore'.
  - name: "backup_file"
    label: "Backup File to Restore"
    type: "text"
    required: true # This field is only required when it's visible.
    placeholder: "e.g., /app/python-scripts/backups/172.27.200.200_set.set"
    description: "Full path inside the container to the configuration file to be restored."
    show_if: { name: "command", value: "restore" }

  - name: "type"
    label: "Restore Load Type"
    type: "enum"
    default: "override"
    required: true
    options:
      - { value: "override", label: "Override (full replace)" }
      - { value: "set", label: "Set Commands" }
      - { value: "merge", label: "Merge" }
    description: "The method used to load the configuration onto the device."
    show_if: { name: "command", value: "restore" }

  - name: "confirmed_commit_timeout"
    label: "Confirmed Commit Timeout (minutes)"
    type: "number"
    default: 5
    description: "Timeout for confirmed commit. A value of 0 disables this safety feature."
    show_if: { name: "command", value: "restore" }
