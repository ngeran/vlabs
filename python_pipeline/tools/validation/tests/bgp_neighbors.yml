tests:
  - command: "show bgp summary"
    iterate:
      xpath: "//bgp-information/bgp-peer"
      id: "peer-address"
      tests:
        - exists: "peer-as"
          info: "BGP peer <peer-address> AS <peer-as> discovered"
          err: "BGP peer <peer-address> AS number not found"
        - is-equal: "peer-state, Established"
          info: "BGP peer <peer-address> is <peer-state>"
          err: "BGP peer <peer-address> is not Established (state=<peer-state>)"
        - is-lt: "flap-count, 10"
          info: "BGP peer <peer-address> flap-count <flap-count> within threshold"
          err: "BGP peer <peer-address> flap-count excessive: <flap-count>"
        - is-ge: "bgp-rib/received-prefix-count, 0"
          info: "BGP peer <peer-address> received <bgp-rib/received-prefix-count> prefixes"
          err: "BGP peer <peer-address> received-prefix-count missing"
        - is-ge: "bgp-rib/accepted-prefix-count, 0"
          info: "BGP peer <peer-address> accepted <bgp-rib/accepted-prefix-count> prefixes"
          err: "BGP peer <peer-address> accepted-prefix-count missing"